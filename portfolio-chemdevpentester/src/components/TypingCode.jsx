import { useEffect, useState } from "react";
import { Box } from "@mui/material";

const codeLines = [
  {
    indent: 0,
    tokens: [
      { text: "SYSTEM ", color: "#4d94ff" },
      { text: "CHEMICAL_ENGINEER", color: "#a6e22e" },
    ],
  },
  {
    indent: 1,
    tokens: [
      { text: "SPECIALIZATION ", color: "#f92672" },
      { text: "Energy_Efficiency", color: "#ffa64d" },
    ],
  },
  {
    indent: 2,
    tokens: [
      { text: "FOCUS ", color: "#f92672" },
      { text: "Process_Optimization_and_Sustainability", color: "#a6e22e" },
    ],
  },
];

export default function TypingCode() {
  const [visible, setVisible] = useState(() =>
    codeLines.map(line => line.tokens.map(() => 0))
  );
  const [paused, setPaused] = useState(false);

  useEffect(() => {
    let line = 0;
    let token = 0;

    const interval = setInterval(() => {
      if (paused) return;

      setVisible(prev => {
        const copy = prev.map(row => [...row]);
        const currentToken = codeLines[line].tokens[token];

        copy[line][token]++;

        if (copy[line][token] >= currentToken.text.length) {
          copy[line][token] = currentToken.text.length;
          token++;

          if (token >= codeLines[line].tokens.length) {
            token = 0;
            line++;

            if (line >= codeLines.length) {
              setPaused(true);

              setTimeout(() => {
                line = 0;
                token = 0;
                setVisible(codeLines.map(l => l.tokens.map(() => 0)));
                setPaused(false);
              }, 1500);
            }
          }
        }

        return copy;
      });
    }, 45);

    return () => clearInterval(interval);
  }, [paused]);

  return (
    <Box
      sx={{
        mt: "0rem",
        fontFamily: "monospace",
        fontSize: "0.7rem",
        letterSpacing: "0.03em",
        lineHeight: 1.5,
        whiteSpace: "pre",
        color: "#f8f8f2",
        textShadow: "0 0 6px rgba(77,148,255,0.25)",
      }}
    >
      {codeLines.map((line, i) => (
        <Box key={i} sx={{ pl: `${line.indent * 0.8}rem` }}>
          {line.tokens.map((token, j) => (
            <span key={j} style={{ color: token.color }}>
              {token.text.slice(0, visible[i][j])}
            </span>
          ))}
        </Box>
      ))}
    </Box>
  );
}
