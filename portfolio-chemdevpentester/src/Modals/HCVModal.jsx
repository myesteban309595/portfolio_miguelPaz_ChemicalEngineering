import React from "react";
import {
  Modal,
  Box,
  Typography,
  Button,
  Container,
  Grid,
  Divider,
  Stack,
} from "@mui/material";
import CollectionsIcon from "@mui/icons-material/Collections";
import { useRef, useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import FileDownloadIcon from "@mui/icons-material/FileDownload";
import ArticleIcon from "@mui/icons-material/Article";

import { experienceData } from "./data/experienceData";
import { EstudiosData } from "./data/EstudiosData";
import { CursosComplementariosData } from "./data/EstudiosComplementarios";
import { EventosData } from "./data/TalleresSeminariosData";
import { ExperienciaAplicadaData } from "./data/ExperienciaAplicada";

import DownloadSelectorLanguaje from "./DownloadSelectorLanguaje";
import ProjectGalleryModal from "./ProjectGalleryModal";

const HCVModal = ({ open, onClose }) => {
  const experienciaRef = useRef(null);
  const estudiosRef = useRef(null);
  const complementariosRef = useRef(null);
  const eventosRef = useRef(null);
  const experienciaAcademicaAplicadaRef = useRef(null);

  const [selectorConfig, setSelectorConfig] = useState({
    open: false,
    type: "",
  });
  const [modalConfig, setModalConfig] = useState({
    open: false,
    project: null,
  });

  const handleOpenGallery = (project) => {
    console.log("ejecutando operngallery:", project);

    setModalConfig({ open: true, project });
  };

  const handleCloseGallery = () => {
    setModalConfig({ ...modalConfig, open: false });
  };

  const scrollToSection = (ref) => {
    ref.current?.scrollIntoView({
      behavior: "smooth",
      block: "start",
    });
  };

  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: { staggerChildren: 0.2, delayChildren: 0.3 },
    },
  };

  const itemVariants = {
    hidden: { y: 20, opacity: 0 },
    visible: { y: 0, opacity: 1 },
  };

  return (
    <AnimatePresence>
      {open && (
        <Modal
          open={open}
          onClose={onClose}
          closeAfterTransition
          sx={{
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            zIndex: 1300,
          }}
        >
          <Box sx={{ outline: "none" }}>
            <motion.div
              initial={{ opacity: 0, scale: 1.1 }}
              animate={{ opacity: 1, scale: 1 }}
              exit={{ opacity: 0, scale: 0.95, filter: "blur(10px)" }}
              transition={{ duration: 0.4 }}
              style={{
                width: "100vw",
                height: "100vh",
                background:
                  "radial-gradient(circle at 50% 50%, #1a1a1a 0%, #0a0a0a 100%)",
                backdropFilter: "blur(20px)",
                color: "white",
                display: "flex",
                flexDirection: "column",
                overflowY: "auto",
                position: "fixed",
                top: 0,
                left: 0,
              }}
            >
              {/* --- HEADER FLOTANTE / BARRA DE ACCIONES --- */}
              <Box
                sx={{
                  position: "fixed",
                  top: 0,
                  left: 0,
                  right: 0,
                  p: 2,
                  display: "flex",
                  justifyContent: "space-between",
                  alignItems: "center",
                  background: "rgba(255, 255, 255, 0.03)",
                  backdropFilter: "blur(10px)",
                  borderBottom: "1px solid rgba(0, 229, 255, 0.1)",
                  zIndex: 2100,
                  px: { xs: 2, md: 6 },
                }}
              >
                <Typography
                  variant="h6"
                  sx={{
                    color: "#00e5ff",
                    fontWeight: "bold",
                    letterSpacing: 2,
                  }}
                >
                  PORTFOLIO ASSETS
                </Typography>

                <Stack direction="row" spacing={2}>
                  {/* Botón Carta de Presentación */}
                  <Button
                    variant="outlined"
                    startIcon={<ArticleIcon />}
                    // onClick={() => handleDownload("CartaPresentacion1.pdf")}
                    onClick={() =>
                      setSelectorConfig({ open: true, type: "carta" })
                    }
                    sx={{
                      display: { xs: "none", sm: "flex" },
                      borderColor: "rgba(0, 229, 255, 0.5)",
                      color: "#fff",
                      borderRadius: "8px",
                      textTransform: "none",
                      "&:hover": {
                        borderColor: "#00e5ff",
                        background: "rgba(0, 229, 255, 0.05)",
                      },
                    }}
                  >
                    Carta Presentación
                  </Button>

                  {/* Botón CV Principal */}
                  <Button
                    variant="contained"
                    startIcon={<FileDownloadIcon />}
                    // onClick={() => handleDownload("IngenieroQuimicoHojaVida.pdf")}
                    onClick={() =>
                      setSelectorConfig({ open: true, type: "cv" })
                    }
                    sx={{
                      background: "linear-gradient(90deg, #00e5ff, #00bfa6)",
                      color: "#000",
                      fontWeight: "bold",
                      borderRadius: "8px",
                      textTransform: "none",
                      boxShadow: "0 0 15px rgba(0, 229, 255, 0.4)",
                      "&:hover": {
                        transform: "scale(1.05)",
                        boxShadow: "0 0 25px rgba(0, 229, 255, 0.6)",
                        background: "linear-gradient(90deg, #00bfa6, #00e5ff)",
                      },
                    }}
                  >
                    Descargar CV
                  </Button>

                  <Divider
                    orientation="vertical"
                    flexItem
                    sx={{ bgcolor: "rgba(255,255,255,0.1)", mx: 1 }}
                  />

                  <Button
                    onClick={onClose}
                    sx={{
                      color: "#ff1744",
                      minWidth: "auto",
                      fontWeight: "bold",
                      fontSize: "1.2rem",
                      "&:hover": {
                        transform: "rotate(90deg)",
                        transition: "0.3s",
                      },
                    }}
                  >
                    ✕
                  </Button>
                </Stack>
              </Box>

              {/* --- CONTENIDO PRINCIPAL --- */}
              <Container
                maxWidth="lg"
                component={motion.div}
                variants={containerVariants}
                initial="hidden"
                animate="visible"
                sx={{ py: 12 }}
              >
                <Grid container spacing={4}>
                  {/* Columna Lateral */}
                  <Grid
                    item
                    xs={12}
                    md={4}
                    component={motion.div}
                    variants={itemVariants}
                  >
                    <Typography
                      variant="h3"
                      sx={{
                        fontWeight: "bold",
                        color: "#00e5ff",
                        mb: 1,
                        textShadow: "0 0 20px rgba(0,229,255,0.3)",
                      }}
                    >
                      Curriculum Vitae
                    </Typography>
                    <Typography
                      variant="h5"
                      sx={{
                        color: "#fff",
                        mb: 4,
                        letterSpacing: 1,
                        opacity: 0.8,
                      }}
                    >
                      Ingeniero y Especialista Miguel Paz Rosero
                    </Typography>

                    <Divider
                      sx={{ borderColor: "rgba(0,229,255,0.2)", mb: 4 }}
                    />

                    <Box
                      sx={{
                        p: 2,
                        borderRadius: "16px",
                        background: "rgba(255,255,255,0.03)",
                        border: "1px solid rgba(255,255,255,0.05)",
                      }}
                    >
                      <Typography
                        variant="overline"
                        sx={{
                          color: "#00e5ff",
                          fontWeight: "bold",
                          display: "block",
                          mb: 1.2,
                        }}
                      >
                        Estrategia & Visión
                      </Typography>
                      <Typography
                        variant="body2"
                        sx={{
                          color: "#aaa",
                          textAlign: "justify",
                          lineHeight: 1.8,
                        }}
                      >
                        Consolidarme como un Ingeniero Químico líder en
                        eficiencia energética, optimización y mejora continua de
                        procesos industriales, reconocido por impulsar
                        soluciones innovadoras, seguras y sostenibles que
                        generen valor real para la organización, el entorno
                        ambiental y el desarrollo del talento humano.
                      </Typography>
                    </Box>
                  </Grid>
                  <Stack
                    direction="row"
                    justifyContent="center"
                    alignItems="center"
                    spacing={2}
                    sx={{
                      mt: -1,
                      mb: 1.3,
                      width: "100%",
                      display: { xs: "none", md: "flex" },
                    }}
                  >
                    {[
                      { label: "Experiencia Profesional", ref: experienciaRef },
                      {
                        label: "Estudios y cursos realizados",
                        ref: estudiosRef,
                      },
                      {
                        label: "Estudios Complementarios",
                        ref: complementariosRef,
                      },
                      {
                        label: "Competencias Destacadas",
                        ref: eventosRef,
                      },
                      // {
                      //   label: "Experiencia Académica Aplicada",
                      //   ref: experienciaAcademicaAplicadaRef,
                      // },
                    ].map((item, index, array) => (
                      <React.Fragment key={item.label}>
                        <Button
                          onClick={() => scrollToSection(item.ref)}
                          disableRipple
                          sx={{
                            position: "relative",
                            color: "#fff",
                            fontWeight: 500,
                            textTransform: "none",
                            fontSize: "0.9rem",
                            px: 1.5,
                            background: "transparent",
                            cursor: "pointer",

                            "&::after": {
                              content: '""',
                              position: "absolute",
                              left: "50%",
                              bottom: -2,
                              width: 0,
                              height: "2px",
                              background: "#00e5ff",
                              transition: "width 0.3s ease",
                              transform: "translateX(-50%)",
                            },

                            "&:hover": {
                              color: "#00e5ff",
                              background: "transparent",
                            },

                            "&:hover::after": {
                              width: "100%",
                            },
                          }}
                        >
                          {item.label}
                        </Button>

                        {/* Divider vertical ENTRE botones */}
                        {index < array.length - 1 && (
                          <Divider
                            orientation="vertical"
                            flexItem
                            sx={{
                              mx: 1,
                              borderColor: "rgba(255,255,255,0.15)",
                              height: 24,
                              alignSelf: "center",
                            }}
                          />
                        )}
                      </React.Fragment>
                    ))}
                  </Stack>

                  {/* Columna Experiencia */}
                  <Grid
                    ref={experienciaRef}
                    item
                    xs={12}
                    md={8}
                    component={motion.div}
                    variants={itemVariants}
                  >
                    <Typography
                      variant="h5"
                      sx={{
                        color: "#00e5ff",
                        mb: 4,
                        display: "flex",
                        alignItems: "center",
                        fontWeight: "bold",
                      }}
                    >
                      <Box
                        sx={{ width: 30, height: 2, bgcolor: "#00e5ff", mr: 2 }}
                      />
                      EXPERIENCIA PROFESIONAL
                    </Typography>

                    <Box
                      sx={{
                        borderLeft: "2px solid rgba(0,229,255,0.1)",
                        pl: { xs: 2, md: 4 },
                        ml: 1,
                      }}
                    >
                      {experienceData.map((item) => (
                        <Box
                          key={item.id}
                          sx={{ mb: item.active ? 6 : 2, position: "relative" }}
                        >
                          <Box
                            sx={{
                              position: "absolute",
                              left: { xs: "-25px", md: "-41px" },
                              top: "7px",
                              width: "16px",
                              height: "16px",
                              borderRadius: "50%",
                              background: item.active
                                ? "#00e5ff"
                                : "rgba(255,255,255,0.2)",
                              boxShadow: item.active
                                ? "0 0 15px #00e5ff"
                                : "none",
                              border: "4px solid #0a0a0a",
                            }}
                          />

                          <Typography
                            variant="h6"
                            sx={{ color: "#fff", fontWeight: "bold" }}
                          >
                            {item.title}
                          </Typography>

                          <Typography
                            variant="subtitle2"
                            sx={{ color: "#d49228", mb: 0 }}
                          >
                            {item.period}
                          </Typography>

                          <Typography
                            variant="subtitle2"
                            sx={{ color: "#00bfa6", mb: 2 }}
                          >
                            {item.company}
                          </Typography>

                          <Typography
                            variant="body2"
                            sx={{
                              color: "#ccc",
                              lineHeight: 1.7,
                              mt: 0,
                              textAlign: "justify",
                            }}
                          >
                            {item.description}
                          </Typography>
                        </Box>
                      ))}
                    </Box>
                  </Grid>
                  {/* Columna Estudios */}
                  <Grid
                    ref={estudiosRef}
                    item
                    xs={12}
                    md={8}
                    component={motion.div}
                    variants={itemVariants}
                  >
                    <Typography
                      variant="h5"
                      sx={{
                        color: "#00e5ff",
                        mb: 4,
                        display: "flex",
                        alignItems: "center",
                        fontWeight: "bold",
                      }}
                    >
                      <Box
                        sx={{ width: 30, height: 2, bgcolor: "#00e5ff", mr: 2 }}
                      />
                      Estudios y cursos realizados
                    </Typography>

                    <Box
                      sx={{
                        borderLeft: "2px solid rgba(0,229,255,0.1)",
                        pl: { xs: 2, md: 4 },
                        ml: 1,
                      }}
                    >
                      {EstudiosData.map((item) => (
                        <Box
                          key={item.id}
                          sx={{ mb: item.active ? 6 : 2, position: "relative" }}
                        >
                          <Box
                            sx={{
                              position: "absolute",
                              left: { xs: "-25px", md: "-41px" },
                              top: "7px",
                              width: "16px",
                              height: "16px",
                              borderRadius: "50%",
                              background: item.active
                                ? "#00e5ff"
                                : "rgba(255,255,255,0.2)",
                              boxShadow: item.active
                                ? "0 0 15px #00e5ff"
                                : "none",
                              border: "4px solid #0a0a0a",
                            }}
                          />

                          <Typography
                            variant="h6"
                            sx={{ color: "#fff", fontWeight: "bold" }}
                          >
                            {item.title}
                          </Typography>

                          <Typography
                            variant="subtitle2"
                            sx={{ color: "#00bfa6", mb: 0 }}
                          >
                            Fecha de Culminación: ({item.period})
                          </Typography>

                          <Typography
                            variant="body2"
                            sx={{
                              color: "#ccc",
                              lineHeight: 1.7,
                              whiteSpace: "pre-line",
                              mt: -1.3,
                            }}
                          >
                            {item.description}
                          </Typography>
                        </Box>
                      ))}
                    </Box>
                  </Grid>
                  {/* Columna Estudios complementaros */}
                  <Grid
                    ref={complementariosRef}
                    item
                    xs={12}
                    md={8}
                    component={motion.div}
                    variants={itemVariants}
                  >
                    <Typography
                      variant="h5"
                      sx={{
                        color: "#00e5ff",
                        mb: 4,
                        display: "flex",
                        alignItems: "center",
                        fontWeight: "bold",
                      }}
                    >
                      <Box
                        sx={{ width: 30, height: 2, bgcolor: "#00e5ff", mr: 2 }}
                      />
                      Estudios Complementarios
                    </Typography>

                    <Box
                      sx={{
                        borderLeft: "2px solid rgba(0,229,255,0.1)",
                        pl: { xs: 2, md: 4 },
                        ml: 1,
                      }}
                    >
                      {CursosComplementariosData.map((item) => (
                        <Box
                          key={item.id}
                          sx={{ mb: item.active ? 6 : 2, position: "relative" }}
                        >
                          <Box
                            sx={{
                              position: "absolute",
                              left: { xs: "-25px", md: "-41px" },
                              top: "7px",
                              width: "16px",
                              height: "16px",
                              borderRadius: "50%",
                              background: item.active
                                ? "#00e5ff"
                                : "rgba(255,255,255,0.2)",
                              boxShadow: item.active
                                ? "0 0 15px #00e5ff"
                                : "none",
                              border: "4px solid #0a0a0a",
                            }}
                          />

                          <Typography
                            variant="h6"
                            sx={{ color: "#fff", fontWeight: "bold" }}
                          >
                            {item.title}
                          </Typography>

                          <Typography
                            variant="subtitle2"
                            sx={{ color: "#00bfa6", mb: 0 }}
                          >
                            {item.period}
                          </Typography>

                          <Typography
                            variant="body2"
                            sx={{
                              color: "#ccc",
                              lineHeight: 1.7,
                              whiteSpace: "pre-line",
                              mt: -1.3,
                            }}
                          >
                            {item.description}
                          </Typography>
                        </Box>
                      ))}
                    </Box>
                  </Grid>
                  {/* Columna talleres y seminarios */}
                  <Grid
                    ref={eventosRef}
                    item
                    xs={12}
                    md={8}
                    component={motion.div}
                    variants={itemVariants}
                  >
                    <Typography
                      variant="h5"
                      sx={{
                        color: "#00e5ff",
                        mb: 4,
                        display: "flex",
                        alignItems: "center",
                        fontWeight: "bold",
                      }}
                    >
                      <Box
                        sx={{ width: 30, height: 2, bgcolor: "#00e5ff", mr: 2 }}
                      />
                      Competencias Destacadas
                    </Typography>

                    <Box
                      sx={{
                        borderLeft: "2px solid rgba(0,229,255,0.1)",
                        pl: { xs: 2, md: 4 },
                        ml: 1,
                      }}
                    >
                      {EventosData.map((item) => (
                        <Box
                          key={item.id}
                          sx={{ mb: item.active ? 6 : 2, position: "relative" }}
                        >
                          <Box
                            sx={{
                              position: "absolute",
                              left: { xs: "-25px", md: "-41px" },
                              top: "7px",
                              width: "16px",
                              height: "16px",
                              borderRadius: "50%",
                              background: item.active
                                ? "#00e5ff"
                                : "rgba(255,255,255,0.2)",
                              boxShadow: item.active
                                ? "0 0 15px #00e5ff"
                                : "none",
                              border: "4px solid #0a0a0a",
                            }}
                          />

                          <Typography
                            variant="h6"
                            sx={{ color: "#fff", fontWeight: "bold" }}
                          >
                            {item.title}
                          </Typography>

                          <Typography
                            variant="subtitle2"
                            sx={{ color: "#00bfa6", mb: 0 }}
                          >
                            {item.period}
                          </Typography>

                          <Typography
                            variant="body2"
                            sx={{
                              color: "#ccc",
                              lineHeight: 1.7,
                              whiteSpace: "pre-line",
                              mt: -1.3,
                            }}
                          >
                            {item.description}
                          </Typography>
                        </Box>
                      ))}
                    </Box>
                  </Grid>
                  {/* Columna experiencia aplicada */}
                  {/* <Grid
                    ref={experienciaAcademicaAplicadaRef}
                    item
                    xs={12}
                    md={8}
                    component={motion.div}
                    variants={itemVariants}
                  >
                    <Typography
                      variant="h5"
                      sx={{
                        color: "#00e5ff",
                        mb: 4,
                        display: "flex",
                        alignItems: "center",
                        fontWeight: "bold",
                      }}
                    >
                      <Box
                        sx={{ width: 30, height: 2, bgcolor: "#00e5ff", mr: 2 }}
                      />
                      Experiencia acadèmica aplicada
                    </Typography>

                    <Box
                      sx={{
                        borderLeft: "2px solid rgba(0,229,255,0.1)",
                        pl: { xs: 2, md: 4 },
                        ml: 1,
                      }}
                    >
                      {ExperienciaAplicadaData.map((item) => (
                        <Box
                          key={item.id}
                          sx={{ mb: item.active ? 6 : 2, position: "relative" }}
                        >
                          <Box
                            sx={{
                              position: "absolute",
                              left: { xs: "-25px", md: "-41px" },
                              top: "7px",
                              width: "16px",
                              height: "16px",
                              borderRadius: "50%",
                              background: item.active
                                ? "#00e5ff"
                                : "rgba(255,255,255,0.2)",
                              boxShadow: item.active
                                ? "0 0 15px #00e5ff"
                                : "none",
                              border: "4px solid #0a0a0a",
                            }}
                          />

                          <Typography
                            variant="h6"
                            sx={{ color: "#fff", fontWeight: "bold" }}
                          >
                            {item.title}
                          </Typography>

                          <Typography
                            variant="subtitle2"
                            sx={{ color: "#00bfa6", mb: 0 }}
                          >
                            {item.period}
                          </Typography>

                          <Typography
                            variant="body2"
                            sx={{
                              color: "#ccc",
                              lineHeight: 1.7,
                              whiteSpace: "pre-line",
                              mt: -1.3,
                              textAlign: "justify",
                            }}
                          >
                            {item.description}
                          </Typography>

                          {item.images?.length > 0 && (
                            <Button
                              size="small"
                              onClick={() => handleOpenGallery(item)}
                              startIcon={
                                <CollectionsIcon
                                  sx={{ fontSize: "1rem !important" }}
                                />
                              }
                              sx={{
                                mt: 1.5,
                                color: "#00bfa6",
                                textTransform: "none", // Evita que todo sea mayúsculas para más elegancia
                                fontSize: "0.75rem",
                                fontWeight: "600",
                                letterSpacing: "1px",
                                padding: "4px 12px",
                                borderRadius: "4px",
                                border: "1px solid rgba(0, 191, 166, 0.3)",
                                background: "rgba(0, 191, 166, 0.05)",
                                transition: "all 0.3s ease",
                                "&:hover": {
                                  background: "rgba(0, 191, 166, 0.15)",
                                  border: "1px solid #00bfa6",
                                  boxShadow: "0 0 12px rgba(0, 191, 166, 0.4)",
                                  transform: "translateY(-1px)",
                                },
                                "&:active": {
                                  transform: "translateY(0)",
                                },
                              }}
                            >
                              Visualizar Galería
                            </Button>
                          )}
                        </Box>
                      ))}
                    </Box>
                  </Grid> */}
                </Grid>
              </Container>

              {/* --- BOTONES MÓVILES --- */}
              <Box
                sx={{ display: { xs: "block", sm: "none" }, p: 4, mt: "auto" }}
              >
                <Stack spacing={2}>
                  <Button
                    fullWidth
                    variant="contained"
                    // onClick={() => handleDownload("HojaDeVida.pdf")}
                    onClick={() =>
                      setSelectorConfig({ open: true, type: "cv" })
                    }
                    sx={{
                      background: "#00e5ff",
                      color: "#000",
                      fontWeight: "bold",
                    }}
                  >
                    Descargar CV (PDF)
                  </Button>
                  <Button
                    fullWidth
                    variant="outlined"
                    // onClick={() => handleDownload("CartaPresentacion.pdf")}
                    onClick={() =>
                      setSelectorConfig({ open: true, type: "carta" })
                    }
                    sx={{ color: "#fff", borderColor: "#fff" }}
                  >
                    Carta de Presentación
                  </Button>
                </Stack>
              </Box>
            </motion.div>
            {/* MODAL SELECTOR DE IDIOMA DESCARGA CV */}
            <DownloadSelectorLanguaje
              open={selectorConfig.open}
              type={selectorConfig.type}
              onClose={() => setSelectorConfig({ open: false, type: "" })}
            />

            {/* MODAL gallery */}
            <ProjectGalleryModal
              open={modalConfig.open}
              project={modalConfig.project}
              onClose={handleCloseGallery}
            />
          </Box>
        </Modal>
      )}
    </AnimatePresence>
  );
};

export default HCVModal;
