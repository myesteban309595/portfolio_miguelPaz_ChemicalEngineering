import React from "react";
import { Box, Typography, Button, Stack, Modal, Backdrop } from "@mui/material";
import { motion, AnimatePresence } from "framer-motion";

const DownloadSelectorLanguaje = ({ open, onClose, type }) => {
  
  const files = {
    cv: {
      es: "IngenieroQuimicoHojaVida_ES.pdf",
      en: "IngenieroQuimicoHojaVida_EN.pdf",
    },
    carta: {
      es: "CartaPresentacion_ES.pdf",
      en: "CartaPresentacion_EN.pdf",
    },
  };

  // Lógica de descarga interna
  const handleInternalDownload = (fileName) => {    
    if (!fileName) return;

    const fileUrl = `/Documentos/${fileName}`;
    const link = document.createElement("a");
    link.href = fileUrl;
    link.setAttribute("download", fileName);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    // Cerramos el modal después de iniciar la descarga
    onClose();
  };

  return (
    <Modal
      open={open}
      onClose={onClose}
      closeAfterTransition
      slots={{ backdrop: Backdrop }}
      slotProps={{
        backdrop: {
          timeout: 500,
          sx: { backgroundColor: "rgba(0, 0, 0, 0.8)" }
        },
      }}
      sx={{
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        zIndex: 3500,
      }}
    >
      <Box sx={{ outline: "none", border: "none" }}>
        <AnimatePresence>
          {open && (
            <motion.div
              initial={{ opacity: 0, scale: 0.9, y: 20 }}
              animate={{ opacity: 1, scale: 1, y: 0 }}
              exit={{ opacity: 0, scale: 0.9, y: 20 }}
              transition={{ type: "spring", damping: 25, stiffness: 300 }}
            >
              <Box
                sx={{
                  bgcolor: "#111",
                  p: 4,
                  borderRadius: "24px",
                  textAlign: "center",
                  border: "1px solid rgba(0, 229, 255, 0.3)",
                  boxShadow: "0 0 40px rgba(0, 229, 255, 0.2)",
                  maxWidth: 350,
                  mx: 2,
                }}
              >
                <Typography
                  variant="h6"
                  sx={{ color: "#00e5ff", fontWeight: "bold", mb: 1 }}
                >
                  {type === "cv" ? "Curriculum Vitae" : "Cover Letter"}
                </Typography>
                <Typography variant="body2" sx={{ color: "#aaa", mb: 3 }}>
                  Select the document language
                </Typography>

                <Stack spacing={2}>
                  <Button
                    fullWidth
                    variant="outlined"
                    onClick={() => handleInternalDownload(files[type]?.es)}
                    sx={{
                      borderColor: "rgba(255,255,255,0.2)",
                      color: "#fff",
                      py: 1.5,
                      borderRadius: "12px",
                      textTransform: "none",
                      "&:hover": {
                        borderColor: "#00e5ff",
                        background: "rgba(0, 229, 255, 0.05)",
                      },
                    }}
                  >
                    Versión Español
                  </Button>

                  <Button
                    fullWidth
                    variant="contained"
                    onClick={() => handleInternalDownload(files[type]?.en)}
                    sx={{
                      background: "linear-gradient(90deg, #00e5ff, #00bfa6)",
                      color: "#000",
                      py: 1.5,
                      borderRadius: "12px",
                      fontWeight: "bold",
                      textTransform: "none",
                      "&:hover": { transform: "scale(1.02)" },
                    }}
                  >
                    English Version
                  </Button>

                  <Button
                    onClick={onClose}
                    sx={{
                      color: "#ff1744",
                      fontSize: "0.8rem",
                      textTransform: "none",
                    }}
                  >
                    Cancel
                  </Button>
                </Stack>
              </Box>
            </motion.div>
          )}
        </AnimatePresence>
      </Box>
    </Modal>
  );
};

export default DownloadSelectorLanguaje;