import { Box, Typography, Button } from "@mui/material";
import { motion, AnimatePresence } from "framer-motion";
import { useState, useEffect } from "react";

const projects = [
  {
    title: "Ambiocom SAS",
    description: `Proyecto de gestión empresarial con enfoque en eficiencia y escalabilidad, monitoreo y gestion de la informaciòn en la gerencia de operaciones y 
            administrativas, analisis de datos, generacion de informes y trazabilidades, desarrollado con las Tecnologías: React vite, Node.js, MongoDB Atlas.`,
    demoLink: "#",
    image: "/ProjectsImages/Ambiocomsas/ambiocomlogin.png",
    backgroundImages: [
      "/ProjectsImages/Ambiocomsas/ambiocomcaptura3.JPG",
      "/ProjectsImages/Ambiocomsas/ambiocomcaptura1.JPG",
      "/ProjectsImages/Ambiocomsas/ambiocomcaptura2.JPG",
      "/ProjectsImages/Ambiocomsas/ambiocomcaptura4.JPG",
      "/ProjectsImages/Ambiocomsas/ambiocomcaptura5.JPG",
      "/ProjectsImages/Ambiocomsas/ambiocomcaptura7.JPG",
    ],
  },
  {
    title: "Clinica Quiropractica HC",
    description: `Gestión de tareas administrativas y cronogramas mediante el desarrollo de un sistema de gestión de usuarios, agendamiento de citas y programaciones médicas, 
             con anexos documentales, radiografías y seguimiento de sesiones, usando React Vite, Node.js y MongoDB Atlas`,
    demoLink: "#",
    image: "/ProjectsImages/Quiropractico/clinicaquiropractica.JPG",
    backgroundImages: [
      "/ProjectsImages/Quiropractico/quiro1.JPG",
      "/ProjectsImages/Quiropractico/quiro2.JPG",
      "/ProjectsImages/Quiropractico/quiro3.JPG",
      "/ProjectsImages/Quiropractico/quiro4.JPG",
      "/ProjectsImages/Quiropractico/quiro.JPG",
      "/ProjectsImages/Quiropractico/quiro6.JPG",
      "/ProjectsImages/Quiropractico/quiro10.JPG",
    ],
  },
  {
    title: "Tienda de mascotas Peluditos Trendy",
    description: `Aplicación web privada orientada a la gestión de clientes y ventas de productos personalizados para mascotas, con login por roles, visualización de productos, 
             carrito de compras y control de stock. Desarrollada en React, Node.js y base de datos MySQL.`,
    demoLink: "#",
    image: "/ProjectsImages/PeluditosTrendy/peluditos1.jpeg",
    backgroundImages: [
      "/ProjectsImages/PeluditosTrendy/peluditos2.jpeg",
      "/ProjectsImages/PeluditosTrendy/peluditos11.jpeg",
      "/ProjectsImages/PeluditosTrendy/peluditos4.jpeg",
      "/ProjectsImages/PeluditosTrendy/peluditos5.jpeg",
      "/ProjectsImages/PeluditosTrendy/peluditos6.jpeg",
      "/ProjectsImages/PeluditosTrendy/peluditos8.jpeg",
    ],
  },
  {
    title: "Frontend Support Developer para el Sector de Hidrocarburos",
    description: `Aplicación web privada para la gestión operativa de despachos de crudo en Campo Rubiales, incluyendo generación de guías, control de sellos, movimientos entre 
             tanques y cálculos ingenieriles. Participé principalmente en el desarrollo frontend y en la arquitectura y despliegue de la base de datos SQL Server en Azure. 
             Desarrollada con .NET Core 7, Blazor WebAssembly y Entity Framework, y desplegada en servidores internos.`,
    demoLink: "#",
    image: "/ProjectsImages/PetraServices/petra1.png",
    backgroundImages: [
      "/ProjectsImages/PetraServices/petra2.jpeg",
      "/ProjectsImages/PetraServices/petra3.jpeg",
      "/ProjectsImages/PetraServices/petra4.jpeg",
      "/ProjectsImages/PetraServices/petra5.jpeg",
    ],
  },
];

export default function ProjectCarrousel() {
  const [current, setCurrent] = useState(0); 
  const [bgIndex, setBgIndex] = useState(0); 

  // Auto cambio de fondo + cambio de proyecto
  useEffect(() => {
    const interval = setInterval(() => {
      setBgIndex((prev) => {
        const total = projects[current].backgroundImages.length;

        if (prev + 1 >= total) {
          // Ya se recorrieron todas las imágenes de fondo
          setCurrent((cPrev) => (cPrev + 1) % projects.length);
          return 0; // reiniciar fondos para el nuevo proyecto
        }

        return prev + 1; // avanzar fondo
      });
    }, 2000); // velocidad de cambio de fondo
    return () => clearInterval(interval);
  }, [current]);

  const handlePrev = () =>
    setCurrent((prev) => (prev - 1 + projects.length) % projects.length);
  const handleNext = () => setCurrent((prev) => (prev + 1) % projects.length);

  return (
    <Box
      id="proyectos"
      sx={{
        width: "100%",
        height: "100vh",
        overflow: "hidden",
        position: "relative",
      }}
    >
      <AnimatePresence initial={false}>
        {projects.map((p, i) =>
          i === current ? (
            <motion.div
              key={i}
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              transition={{ duration: 0.4 }}
              style={{
                position: "absolute",
                width: "100%",
                height: "100%",
              }}
            >
              {/* Imagen de fondo con slideshow */}
              <AnimatePresence mode="wait">
                <motion.img
                  key={p.backgroundImages[bgIndex]}
                  src={p.backgroundImages[bgIndex]}
                  alt={p.title}
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  exit={{ opacity: 0 }}
                  transition={{ duration: 0.5 }}
                  style={{
                    width: "100%",
                    height: "100%",
                    objectFit: "cover",
                    filter: "brightness(0.55)",
                    position: "absolute",
                    top: 0,
                    left: 0,
                  }}
                />
              </AnimatePresence>

              {/* Contenedor central */}
              <Box
                sx={{
                  position: "absolute",
                  top: "50%",
                  left: "50%",
                  transform: "translate(-50%, -50%)",
                  width: "90%",
                  height: "90%",
                  display: "flex",
                  flexDirection: { xs: "column", md: "row" },
                  alignItems: "center",
                  justifyContent: "center",
                  gap: "2rem",
                  color: "white",
                }}
              >
                {/* Imagen del proyecto */}
                <Box
                  component="img"
                  src={p.image}
                  alt={p.title}
                  sx={{
                    flex: 1,
                    maxWidth: { xs: "100%", md: "50%" },
                    borderRadius: "16px",
                    objectFit: "cover",
                    boxShadow: "0 10px 40px rgba(0,0,0,0.6)",
                  }}
                />

                {/* Texto */}
                <Box
                  sx={{
                    flex: 1,
                    px: { xs: 0, md: 4 },
                    textAlign: { xs: "center", md: "left" },
                  }}
                >
                  <Typography
                    variant="h3"
                    sx={{
                      fontWeight: "bold",
                      mb: 3,
                      fontSize: "clamp(1.4rem, 3vw, 3rem)",
                      lineHeight: 1.2,
                      wordBreak: "break-word",
                    }}
                  >
                    {p.title}
                  </Typography>
                  <Typography
                    variant="h6"
                    sx={{
                      color: "#ccc",
                      mb: 4,
                      fontSize: "clamp(0.95rem, 1.2vw, 1.15rem)",
                      lineHeight: 1.7,
                      textAlign: "justify",
                      textJustify: "inter-word",
                      hyphens: "auto",
                      wordBreak: "break-word",
                    }}
                  >
                    {p.description}
                  </Typography>
                  <Button
                    variant="contained"
                    color="primary"
                    href={p.demoLink}
                    target="_blank"
                    sx={{ px: 4, py: 1.5 }}
                  >
                    Ver Demo
                  </Button>
                </Box>
              </Box>

              {/* Botones de navegación */}
              <Box
                onClick={handlePrev}
                sx={{
                  position: "absolute",
                  top: 0,
                  left: 0,
                  height: "100%",
                  width: { xs: "50px", md: "70px" },
                  background: "rgba(0,0,0,0.05)",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  cursor: "pointer",
                  "&:hover": {
                    background: "rgba(0,0,0,0.2)",
                  },
                  zIndex: 5,
                }}
              >
                <Typography
                  component="span"
                  sx={{ color: "rgba(255,255,255,0.4)", fontSize: "2rem" }}
                >
                  ❮
                </Typography>
              </Box>

              <Box
                onClick={handleNext}
                sx={{
                  position: "absolute",
                  top: 0,
                  right: 0,
                  height: "100%",
                  width: { xs: "50px", md: "70px" },
                  background: "rgba(0,0,0,0.05)",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  cursor: "pointer",
                  "&:hover": {
                    background: "rgba(0,0,0,0.2)",
                  },
                  zIndex: 5,
                }}
              >
                <Typography
                  component="span"
                  sx={{ color: "rgba(255,255,255,0.4)", fontSize: "2rem" }}
                >
                  ❯
                </Typography>
              </Box>
            </motion.div>
          ) : null
        )}
      </AnimatePresence>
    </Box>
  );
}
